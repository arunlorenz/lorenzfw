import java.nio.file.Files
import java.nio.file.Paths

task deploy(dependsOn: jar, type: Exec) {
    def alias = "local"
    def bucket = "lorenzsuite"
    def objectPath = "lorenzfw/${jar.archiveFile.get().asFile.name}"
    def filePath = jar.archiveFile.get().asFile.absolutePath
    def endpoint = "http://127.0.0.1:9000"
    def accessKey = "minioadmin"
    def secretKey = "minioadmin"

    doFirst {
        exec {
            commandLine "mc", "alias", "set", alias, endpoint, accessKey, secretKey
            ignoreExitValue = true
        }

        exec {
            commandLine "mc", "mb", "--ignore-existing", "${alias}/${bucket}"
        }

        println "ðŸ“¤ Uploading ${filePath} to ${alias}/${bucket}/${objectPath}"
    }

    commandLine "mc", "cp", filePath, "${alias}/${bucket}/${objectPath}"
}
